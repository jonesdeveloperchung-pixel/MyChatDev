graph TD
    subgraph "Phase 1: Strategic Planning"
        direction LR
        A[Human Operator] --> P1(Requirements Analysis);
        P1 --> P2(System Design);
        M[Experience/Memory] --> P1;
        P2 --> HIOptional{"(Optional) Human Approval"};
    end

    HIOptional --> Sandbox(Phase 2: Sandboxed Development);

    subgraph "Internal Sandbox Loop (Abstracted)"
        direction TB
        Sandbox -- "Input: Design, Tests" --> InternalLoop(Code → Compile → Test → Debug);
        InternalLoop -- "Repeats until tests pass" --> InternalLoop;
        InternalLoop -- "Output: Validated Code" --> Review;
    end

    Review(Phase 3: Holistic Review) --> QG;

    subgraph "Phase 4: Adaptive Quality & Refinement"
        direction TB
        QG(A. Quality Gate Evaluation);
        QG -- "Quality Stagnated" --> Reflect(B. Reflector Agent);
        Reflect -- "New Strategy" --> P1;
        QG -- "Quality Improving" --> P1;
        QG -- "Quality Threshold Met" --> Done((✅ Deliverables Ready));
        Done --> M;
    end

    style Sandbox fill:#f9f,stroke:#333,stroke-width:2px
